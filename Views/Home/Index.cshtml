<h2>Home view</h2>

<button id="runOperation">Run operation</button>

<ul id="operationsList">

</ul>

@section scripts {
        <!--Script references. -->
    <!--Reference the jQuery library. -->
    <script src="~/Scripts/jquery-2.1.3.js"></script>
    <!--Reference the SignalR library. -->
    <script src="~/Scripts/jquery.signalR-2.2.0.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>

    <script>
        $(function () {
            // Reference the auto-generated proxy for the hub.  
            var operationsHub = $.connection.operationsHub,
                $operationsList = $('#operationsList');
            
            
            function updateOperationsList(operations) {
                var currentTasks = operations || [];

                //clear list
                $operationsList.html('');

                currentTasks.forEach(addOperationToList);
            }

            function addOperationToList(task) {
                $operationsList.append('<li data-id="' + task.Id + '"><span><b>' + task.Id + '</b></span> ' + task.Name + '<button class="js-remove-operation">Remove</button></li>');
            }

            //client methods that can be called from server
            operationsHub.client.updateOperations = updateOperationsList;
            operationsHub.client.addNewOperation = addOperationToList;
            operationsHub.client.removeOperation = function (id) {
                $operationsList.find('[data-id=' + id + ']').remove();
            };

            // Init operations list
            function init() {

                //call server method from client
                operationsHub.server.getAllOperations().done(updateOperationsList);

                $('#runOperation').on('click', function () {
                    //call server method from client
                    operationsHub.server.runNewOperation();
                });

                $operationsList.on('click', '.js-remove-operation', function (e) {

                    var operationId = $(e.target).parent('li').data('id');

                    //call server method from client
                    operationsHub.server.removeOperation(operationId);
                });
            }

            // Start the connection
            $.connection.hub.logging = true;
            $.connection.hub.start().done(init);
        });
    </script>
}